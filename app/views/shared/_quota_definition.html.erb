<%= link_to order_number.number, "##{order_number.id}", class: 'reference numerical', title: 'Opens in a popup', 'data-popup-ref' => "#{order_number.id}" %>&nbsp;

<div class="popup govuk-visually-hidden" data-popup="<%= order_number.id %>">
  <article>
    <% if order_number.definition.present? %>
      <table class="govuk-table govuk-table-m">
        <h2 class="govuk-heading-m">Quota order number <%= order_number.number %></h2>

        <% if order_number.show_warning? %>
          <div class="govuk-warning-text">
          <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
          <strong class="govuk-warning-text__text">
            <span class="govuk-warning-text__assistive">Warning</span>
            <%= quota_definition.warning_text %>
          </strong>
          </div>
        <% end %>
        <tbody class="govuk-table__body">
          <tr class="govuk-table__row">
            <th scope="col" class='govuk-table__header'>
              Balance
              <span class="govuk-!-font-weight-regular">
                (as of <%= @search.date.to_formatted_s :short %>)
              </div>
            </th>
            <td class="numerical govuk-table__cell numerical">
              <%= number_with_precision quota_definition.balance, precision: 3, delimiter: ',' %>
              <%= quota_definition.measurement_unit %>
              <% unless @search.date.today? %>
                <br />
                <%= link_to url_for(day: Date.today.day, month: Date.today.month, year: Date.today.year, anchor: order_number.id) do %>
                  View balance for <%= Date.today.to_formatted_s :short %>
                <% end %>
              <% end %>
            </td>
          </tr>
          <tr class="govuk-table__row">
            <th scope="col" class='govuk-table__header'>Opening balance</th>
            <td class="numerical govuk-table__cell numerical">
              <%= number_with_precision quota_definition.initial_volume, precision: 3, delimiter: ',' %>
              <%= quota_definition.measurement_unit %>
            </td>
          </tr>
          <tr class="govuk-table__row">
            <th scope="col" class='govuk-table__header'>Status</th>
            <td class="numerical govuk-table__cell"><%= quota_definition.status %></td>
          </tr>
          <tr class="govuk-table__row">
            <th scope="col" class='govuk-table__header'>Start and end dates</th>
            <td class="numerical govuk-table__cell numerical"><%= start_and_end_dates_for(quota_definition) %></td>
          </tr>
          <tr class="govuk-table__row">
            <th scope="col" class='govuk-table__header'>Last allocation date</th>
            <td class="numerical govuk-table__cell numerical"><%= quota_definition.last_allocation_date.to_formatted_s(:gov) || 'n/a' %></td>
          </tr>
          <tr class="govuk-table__row">
            <th scope="col" class='govuk-table__header'>Suspension period</th>
            <td class="numerical govuk-table__cell numerical"><%= suspension_period_dates_for(quota_definition) %></td>
          </tr>
          <tr class="govuk-table__row">
            <th scope="col" class='govuk-table__header'>Blocking period</th>
            <td class="numerical govuk-table__cell numerical"><%= blocking_period_dates_for(quota_definition) %></td>
          </tr>
        </tbody>
      </table>

      <p class="govuk-!-margin-top-4">
        The status given is correct at the time of the ‘last allocation’. Quota
        allocations are processed daily (excluding weekends and bank holidays),
        and the updated balance will be displayed on the Online Tariff Tool the
        next working day. The information provided within this tool is the most
        up-to-date information that HMRC can provide at any given time.
      </p>
    <% else %>
      <p class="govuk-!-margin-top-4">Information on the availability of this quota can be obtained from the Rural Payments Agency.</p>
    <% end %>
  </article>
</div>
