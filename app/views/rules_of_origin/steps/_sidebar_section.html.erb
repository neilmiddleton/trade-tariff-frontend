<% active_section = sidebar_section.second.map(&:key).include?(current_step.key) %>

<li id="<%= sidebar_section.first %>"
    <%= 'data-show' if active_section %>
    class="app-step-nav__step js-step <%= 'app-step-nav__step--active' if active_section %>">
  <div class="app-step-nav__header js-toggle-panel" data-position="<%= sidebar_section_counter + 1 %>">
    <h3 class="app-step-nav__title">
      <span class="app-step-nav__circle app-step-nav__circle--number">
        <span class="app-step-nav__circle-inner">
          <span class="app-step-nav__circle-background">
            <span class="govuk-visually-hidden"><%= t '.step_label' %></span> <%= sidebar_section_counter + 1 %>
          </span>
        </span>
      </span>

      <span class="js-step-title">
        <%= t "rules_of_origin.steps.sections.#{sidebar_section.first}" %>
      </span>
    </h3>
  </div>

  <div class="app-step-nav__panel js-panel js-hidden" id="step-panel-check-youre-allowed-to-drive-1">
    <%= t("rules_of_origin.steps.sections.#{sidebar_section.first}_info_html",
          commodity_code: current_step.commodity_code,
          trade_country: current_step.trade_country_name,
          commodity_link: link_to(current_step.commodity_code,
                                  commodity_path(current_step.commodity_code,
                                                 country: current_step.trade_country_code)),
          default: nil) %>

    <ol class="app-step-nav__list " data-length="<%= sidebar_section.second.length %>">
      <% sidebar_section.second.each.with_index do |step, index| %>
      <li class="app-step-nav__list-item js-list-item <%= 'app-step-nav__list-item--active' if step.key == current_step.key %>">
        <%= link_to t(".steps.#{step.key}"),
                    step_path(step.key),
                    class: 'app-step-nav__link',
                    data: { position: "#{sidebar_section_counter + 1}.#{index + 1}" } %>
      </li>
      <% end %>
    </ol>
  </div>
</li>
