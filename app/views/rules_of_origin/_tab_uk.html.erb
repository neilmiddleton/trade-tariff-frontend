<%= render 'rules_of_origin/find_out_more' %>

<h2 class="govuk-heading-m rules-of-origin-heading">
  Trading with <%=country_name%>
  <%= country_flag_tag country_code, alt: "Flag for #{country_name}" %>
</h2>

<% if rules_of_origin_schemes.any? %>
  <p>
    Preferential tariff treatment reduces the duties you are required to pay when importing or exporting goods to or from <%= country_name %>.
  </p>

  <p>
    Rules of origin are the criteria which determine the national source of a product. They determine if your trade is eligible for preferential tariff treatment and may influence the rules that apply to your import or export.
  </p>

  <%= rules_of_origin_schemes_intro country_name, rules_of_origin_schemes %>

  <% if declarable.import_trade_summary.basic_third_country_duty.present? %>
    <%= render 'rules_of_origin/import_trade_summary',
               import_trade_summary: declarable.import_trade_summary unless rules_of_origin_schemes.many? %>
  <% end %>

  <%= render 'rules_of_origin/wizard_link', rules_of_origin_schemes:,
                                            country_code:,
                                            commodity_code:,
                                            declarable: %>

  <div class="rules-of-origin__scheme govuk-!-margin-bottom-7">
    <h3 class="govuk-heading-m" id="product-specific-rules">
      Product-specific rules - trade with <%= country_name %>
    </h3>

    <%= render partial: 'rules_of_origin/scheme',
               collection: rules_of_origin_schemes,
               locals: { commodity_code: } %>

    <%= render 'rules_of_origin/proofs', schemes: rules_of_origin_schemes,
                                         commodity_code:,
                                         country_code: %>
  </div>
<% else %>
  <p class="govuk-inset-text govuk-!-margin-top-2">
    Preferential tariff treatment for trading with <%= country_name %> is not available for this product.
    You can select another country to check where preferential tariff treatments apply.
  </p>
<% end %>

<%= render 'rules_of_origin/non_preferential_uk' %>

<div id="rules-of-origin__related-content">
  <h2 class="govuk-heading-m">
    Related content
  </h2>

  <nav role="navigation">
    <ul class="govuk-list govuk-list-s">
      <% if rules_of_origin_schemes.flat_map(&:links).any? %>
        <% rules_of_origin_schemes.flat_map(&:links).uniq(&:id).each do |link| %>
          <li>
            <%= link_to link.text, link.url %>
          </li>
        <% end %>
      <% else %>
        <li><a href="https://www.gov.uk/guidance/check-your-goods-meet-the-rules-of-origin">Check your goods meet the rules of origin</a></li>
      <% end %>
    </ul>
  </nav>
</div>
